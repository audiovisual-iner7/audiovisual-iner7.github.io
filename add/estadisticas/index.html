<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Estadísticas - Audiovisual</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        :root {
            --brand-color: #003C7D;
            --brand-color-light: #0056b3;
            --brand-color-dark: #002a59;
        }
        .bg-brand { background-color: var(--brand-color); }
        .hover\:bg-brand-light:hover { background-color: var(--brand-color-light); }
        .border-brand { border-color: var(--brand-color); }
        .text-brand { color: var(--brand-color); }
        #adminPanel { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .header-logo { height: 50px; width: auto; max-width: 137px; object-fit: contain; }
        @media (max-width: 768px) { .header-logo { height: 40px; max-width: 110px; } }
        .header-content { display: flex; align-items: center; gap: 1rem; }
        
        /* Estilos de Toast (copiados) */
        .toast-notification {
            position: fixed; bottom: 2rem; right: 2rem;
            background-color: var(--brand-color-dark, #002a59); color: white;
            padding: 1rem 1.5rem; border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            z-index: 100; opacity: 0; transform: translateY(20px);
            visibility: hidden; transition: all 0.3s ease-out; max-width: 350px;
        }
        .toast-notification.show { opacity: 1; transform: translateY(0); visibility: visible; }
        .toast-notification.hide { opacity: 0; transform: translateY(20px); visibility: hidden; }
        .toast-notification h4 { font-weight: 700; margin-bottom: 0.5rem; }
        .toast-notification p { font-size: 0.875rem; line-height: 1.3; }
        
        /* Estilo para los contenedores de gráficas */
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-100">

    <header class="bg-brand shadow-md">
        <div class="container mx-auto px-6 py-4">
            <div class="header-content">
                <a href="#"><img src="../img/logo iner blanco-04.png" alt="Logo Institucional" class="header-logo"></a> 
                <div class="flex-1">
                    <a href="#"><h1 class="text-2xl font-bold text-white">Panel de Estadísticas</h1></a>
                </div>
                
                <div class="relative" id="navMenu">
                    <button id="menuBtn" type="button" class="inline-flex items-center gap-x-1.5 rounded-md bg-brand px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-brand-light">
                        <span>Menú</span>
                        <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" /></svg>
                    </button>
                    <div id="dropdownMenu" class="hidden absolute right-0 z-10 mt-2 w-56 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transition ease-out duration-100">
                        <div class="py-1" role="none">
                            </div>
                    </div>
                </div>
                
                <div id="userInfo" class="text-white text-sm hidden">
                    <span id="welcomeUser"></span>
                    <button id="logoutBtn" class="ml-4 bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors">
                        Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <div id="loginContainer" class="max-w-md mx-auto mt-20">
            <div class="bg-white p-8 rounded-xl shadow-lg">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Estadísticas</h2>
                    <p class="text-gray-600">Ingrese sus credenciales para continuar</p>
                </div>
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700 mb-1">Usuario</label>
                        <input type="text" id="username" name="username" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-brand focus:border-brand">
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Contraseña</label>
                        <input type="password" id="password" name="password" required class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-brand focus:border-brand">
                    </div>
                    <div id="loginError" class="hidden text-red-600 text-sm text-center"></div>
                    <button type="submit" id="loginBtn" class="w-full bg-brand text-white font-bold py-3 px-4 rounded-lg hover:bg-brand-light transition-colors duration-300">
                        <span id="loginBtnText">Iniciar Sesión</span>
                        <div id="loginSpinner" class="hidden inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"></div>
                    </button>
                </form>
            </div>
        </div>

        <div id="adminPanel">
            
            <div class="bg-white rounded-xl shadow-lg p-4 mb-8 flex flex-wrap items-center gap-4">
                
                <label for="filtroTipoPeriodo" class="font-medium">Periodo:</label>
                <select id="filtroTipoPeriodo" class="border-gray-300 rounded-md">
                    <option value="mes">Mes Específico</option>
                    <option value="anio">Año Completo</option>
                </select>

                <label for="filtroMes" class="font-medium">Mes:</label>
                <select id="filtroMes" class="border-gray-300 rounded-md"></select>
                
                <label for="filtroAnio" class="font-medium">Año:</label>
                <select id="filtroAnio" class="border-gray-300 rounded-md"></select>
                
                <button id="actualizarBtn" class="bg-brand text-white font-medium py-2 px-4 rounded-lg hover:bg-brand-light">
                    Actualizar
                </button>
            </div>

            <div id="loadingState" class="text-center py-10">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-brand mx-auto mb-4"></div>
                <p class="text-gray-600 text-lg">Cargando estadísticas...</p>
            </div>
            
            <div id="statsContainer" class="hidden space-y-8">
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-sm font-medium text-gray-500">Eventos Totales</p>
                        <p id="kpiTotalEventos" class="text-4xl font-bold text-brand mt-2">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-sm font-medium text-gray-500">Eventos Completados</p>
                        <p id="kpiCompletados" class="text-4xl font-bold text-green-600 mt-2">0</p>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <p class="text-sm font-medium text-gray-500">Eventos Cancelados</p>
                        <p id="kpiCancelados" class="text-4xl font-bold text-red-600 mt-2">0</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Eventos por Tipo</h3>
                        <div class="chart-container">
                            <canvas id="chartEventosPorTipo"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Eventos Asignados por Persona</h3>
                        <div class="chart-container">
                            <canvas id="chartEventosPorAsignado"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Servicios Entregados por Persona</h3>
                        <div class="chart-container">
                            <canvas id="chartServiciosPorPersona"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4">Top Servicios Requeridos</h3>
                        <div class="chart-container">
                            <canvas id="chartServiciosRequeridos"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <footer class="bg-gray-800 text-white text-center p-4 mt-12">
        <p>&copy; 2025 Instituto Nacional de Enfermedades Respiratorias INER. Todos los derechos reservados.</p>
    </footer>

    <script src="./stats.js"></script>
</body>
</html>